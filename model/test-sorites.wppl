var csv_data = utils.readCSV('prior_means.csv').data;
var header = csv_data[0];
var data = csv_data.slice(1, csv_data.length - 1);

var get_item = function(line) {
  return line[0];
}
var get_lowers = function(line) {
  var lower = utils.float(line[1]);
  return lower;
}
var get_probability = function(line) {
  var prob = utils.float(line[2]);
  return prob;
}
var get_prior_version = function(line) {
  return line[3];
}

var get_prior_data = cache(function(object, prior_version) {
  var prior_data = filter(function(line) {
    return get_prior_version(line) == prior_version & get_item(line) == object;
  }, data);
  var values = map(get_lowers, prior_data);
  var probabilities = map(get_probability, prior_data);
  return {
    values: values,
    probabilities: probabilities
  }
})

var get_price_prior = function(object, prior_version) {
  return function () {
    var prior_data = get_prior_data(object, prior_version);
    return prior_data.values[discrete(prior_data.probabilities)];
  }
}

// head of csv file:
// { data: 
//    [ [ 'item', 'lowers', 'probability', 'prior_version' ],
//      [ 'sweater', '0', '0.00198956401670392', 'v4_actual' ],
//      [ 'sweater', '3', '0.00447944726095418', 'v4_actual' ],
//      [ 'sweater', '6', '0.00452885388594682', 'v4_actual' ],

var get_theta_prior = function(object, prior_version) {
  return function() {
    var prior_data = get_prior_data(object, prior_version);
    return uniformDraw(prior_data.values);
  }
}

get_price_prior("laptop", "exp1")();