// simpleCSV.js

var fs = require('fs');
var babyparse = require('babyparse');

function readCSV(filename){
  var csv_data = babyparse.parse(fs.readFileSync(filename, 'utf8'));
  var lst = csv_data.data;
  var header = lst[0];
  var csv_lst = [];
  for (var i=1; i<lst.length; i++) {
  	// first item is header
  	var item = {};
  	for (var h=0; h<header.length; h++) {
  		var label = header[h];
  		var value = lst[i][h];
  		var possible_numeric_value = parseFloat(value);
  		if (isNaN(possible_numeric_value)) {
	  		item[label] = value;
	  	} else {
	  		item[label] = possible_numeric_value;
	  	}
  	}
  	csv_lst.push(item);
  }
  return csv_lst;
};

function writeCSV(jsonCSV, filename){
  fs.writeFileSync(filename, babyparse.unparse(jsonCSV) + "\n");
}

module.exports = {
  readCSV: readCSV,
  writeCSV: writeCSV
};